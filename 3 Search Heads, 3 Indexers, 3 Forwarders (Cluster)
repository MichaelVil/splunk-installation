User Name: admin
Password: pa$$w0rd
Secret: secret

Search Head 1: 192.168.56.21
Search Head 2: 192.168.56.22
Search Head 3: 192.168.56.23
SH Cluster Label: sh_label

Indexer 1: 192.168.56.11
Indexer 2: 192.168.56.12
Indexer 3: 192.168.56.13
Index Cluster Label: idx_label

Search Head Deployer: 10.5.0.1
Cluster Master (Indexer) (Manager, Master Node): 192.168.56.14
Monitoring Console + Deployment Server + License Master: 192.168.56.17
Deployer (SH): 10.5.0.4


####################################################### Cluster Master (192.168.56.14) #######################################################
#Replication Factor 2, Search Factor 2

/opt/splunk/bin/splunk edit licenser-localslave -master_uri https://192.168.56.17:8089 -auth admin:pa$$w0rd
/opt/splunk/bin/splunk edit cluster-config -mode manager -replication_factor 2 -search_factor 2 -secret secret -cluster_label idx_label -auth admin:pa$$w0rd
/opt/splunk/bin/splunk restart

##################################### Monitoring Console/Deployment Server/License Master (192.168.56.17) #####################################
#Configure DS for the SH cluster
vi /opt/splunk/etc/system/local/server.conf

[shclustering]
shcluster_label = sh_label

/opt/splunk/bin/splunk restart

#Splunk license file
/opt/splunk/etc/licenses/

#Configure MC




######################################## Indexer Cluster (192.168.56.11, 192.168.56.12, 192.168.56.13) ########################################

#run on each of the Indexers: 192.168.56.11, 192.168.56.12, 192.168.56.13)
/opt/splunk/bin/splunk enable listen 9997
/opt/splunk/bin/splunk disable webserver
/opt/splunk/bin/splunk edit licenser-localslave -master_uri https://192.168.56.17:8089 -auth admin:pa$$w0rd
/opt/splunk/bin/splunk edit cluster-config -mode peer -master_uri https://192.168.56.14:8089 -secret secret -replication_port 9100
/opt/splunk/bin/splunk restart

#remove member from Indexer Cluster. Run on each of the Indexers
/opt/splunk/bin/splunk offline --enforce-counts
#remove member from CM
/opt/splunk/bin/splunk remove cluster-peers -peers <guid>,<guid>,<guid>...

########################################################## SH Cluster Configuration ##########################################################

#SH1 (192.168.56.21)
/opt/splunk/bin/splunk init shcluster-config -mgmt_uri https://192.168.56.21:8089 -conf_deploy_fetch_url https://192.168.56.17:8089 -replication_port 9200 -replication_factor 2 -secret secret -shcluster_label sh_label -auth admin:pa$$w0rd
/opt/splunk/bin/splunk edit cluster-config -mode searchhead -master_uri https://192.168.56.14:8089 -secret secret -auth admin:pa$$w0rd
/opt/splunk/bin/splunk restart

#SH2 (192.168.56.22)
/opt/splunk/bin/splunk init shcluster-config -mgmt_uri https://192.168.56.22:8089 -conf_deploy_fetch_url https://192.168.56.17:8089 -replication_port 9200 -replication_factor 2 -secret secret -shcluster_label sh_label -auth admin:pa$$w0rd
/opt/splunk/bin/splunk edit cluster-config -mode searchhead -master_uri https://192.168.56.14:8089 -secret secret -auth admin:pa$$w0rd
/opt/splunk/bin/splunk restart

#SH3 (192.168.56.23)
/opt/splunk/bin/splunk init shcluster-config -mgmt_uri https://192.168.56.23:8089 -conf_deploy_fetch_url https://192.168.56.17:8089 -replication_port 9200 -replication_factor 2 -secret secret -shcluster_label sh_label -auth admin:pa$$w0rd
/opt/splunk/bin/splunk edit cluster-config -mode searchhead -master_uri https://192.168.56.14:8089 -secret secret -auth admin:pa$$w0rd
/opt/splunk/bin/splunk restart

#Configure Captain (192.168.56.21)
/opt/splunk/bin/splunk bootstrap shcluster-captain -servers_list "https://192.168.56.21:8089, https://192.168.56.22:8089, https://192.168.56.23:8089" -auth admin:pa$$w0rd

#Check search head cluster status
/opt/splunk/bin/splunk show shcluster-status -auth admin:pa$$w0rd








#Enable SH (192.168.56.10)
/opt/splunk/bin/splunk add search-server https://192.168.56.11:8089 -auth admin:pop54321 -remoteUsername admin -remotePassword pop54321
/opt/splunk/bin/splunk add search-server https://192.168.56.12:8089 -auth admin:pop54321 -remoteUsername admin -remotePassword pop54321
/opt/splunk/bin/splunk add search-server https://192.168.56.13:8089 -auth admin:pop54321 -remoteUsername admin -remotePassword pop54321

#Forward search head data to the indexer layer (192.168.56.10, 192.168.56.14, 192.168.56.17)
#https://docs.splunk.com/Documentation/Splunk/8.2.2/DistSearch/Forwardsearchheaddata

/nano /opt/splunk/etc/system/local/outputs.conf

# Turn off indexing on the search head
[indexAndForward]
index = false
 
[tcpout]
defaultGroup = my_search_peers 
forwardedindex.filter.disable = true  
indexAndForward = false 
 
[tcpout:my_search_peers]
server=192.168.56.11:9997,192.168.56.12:9997,192.168.56.13:9997



















#Push a bundle (on the Deployer 10.5.0.4)
/opt/splunk/bin/splunk apply shcluster-bundle --answer-yes -target https://10.0.1.1:8089 -auth admin:pa$$w0rd

#Check SH Cluster status (from any SH member)
/opt/splunk/bin/splunk show shcluster-status -auth admin:pa$$w0rd

https://docs.splunk.com/Documentation/Splunk/8.2.2/DistSearch/ViewSHCstatus
